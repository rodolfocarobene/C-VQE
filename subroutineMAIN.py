import copy
from collections import namedtuple

import numpy as np

def iterator_item_to_string(item):
    name = item[0]
    name += '_' + item[1]
    name += '_' + item[2][1]
    name += '_' + item[3][1]
    if item[4] == 'True':
        if item[5][0][0] != 'dummy':
            name += '_Lag_'
            for operator in item[5]:
                name += operator[0]+'('+str(np.round(operator[2], 2))+')'
    elif item[4] == 'Series':
        if item[5][0][0] != 'dummy':
            name += '_LagSeries_'
            for operator in item[5]:
                name += operator[0]+'_'+str(item[6])+'x'+str(np.round(item[7], 2))+'_'
    elif item[4] == 'AUGSeries':
        if item[5][0][0] != 'dummy':
            name += '_LagAUGSeries_'
            for operator in item[5]:
                name += operator[0]+'_'+str(item[6])+'x'+str(np.round(item[7], 2))
                name += '_lamb'+str(np.round(item[8], 2))+'_'

    return name

def from_item_iter_to_option(options, item):
    option = copy.deepcopy(options)
    option['molecule']['basis'] = item[0]
    option['var_form_type'] = item[1]
    option['quantum_instance'] = item[2][0]
    option['optimizer'] = item[3][0]

    if item[4] == 'True' or item[4] == 'False':
        option['lagrange']['active'] = item[4]
        option['lagrange']['series'] = False
        option['lagrange']['augmented'] = False
        option['init_point'] = [None]
    elif item[4] == 'Series':
        option['lagrange']['active'] = True
        option['lagrange']['series'] = True
        option['lagrange']['augmented'] = False
    elif item[4] == 'AUGSeries':
        option['lagrange']['active'] = True
        option['lagrange']['series'] = True
        option['lagrange']['augmented'] = True

    option['lagrange']['operators'] = item[5]

    if item[5][0][0] == 'dummy':
        option['lagrange']['active'] = False

    option['series']['itermax'] = item[6]
    option['series']['step'] = item[7]
    option['series']['lamb'] = item[8]

    return option

def return_classical_results(mol_type):
    classical_calcs = namedtuple('exact_energy', ['fci', 'hf'])
    if mol_type == 'LiH':
        values = classical_calcs([-5.973316751407092, -6.727030739488288,
                                  -7.13946546684442, -7.410885835855126,
                                  -7.597126658827358, -7.725985544735766,
                                  -7.814884068691337, -7.875652564927888,
                                  -7.9165162694244176, -7.943195280450732,
                                  -7.95967514939218, -7.968761975357008,
                                  -7.972464778981656, -7.972249851370465,
                                  -7.969208055492761, -7.9641656147173325,
                                  -7.957758807530722, -7.950485471076731,
                                  -7.94274113449713, -7.934844340669629,
                                  -7.927053736471548, -7.919578458033593,
                                  -7.912583029355406, -7.90618832752589,
                                  -7.900470887976585, -7.895463316791598,
                                  -7.891158087281483, -7.887515339518235,
                                  -7.884473326516027, -7.881959101126991,
                                  -7.879897370245679, -7.87821656514827],
                                 [-5.933995499851168, -6.697234561594182,
                                  -7.1176806604554645, -7.390914707460707,
                                  -7.577846509402896, -7.70746147083358,
                                  -7.797113019388118, -7.85847294386209,
                                  -7.899660568510616, -7.926337553251482,
                                  -7.942463271807607, -7.950835567324477,
                                  -7.95346161954278, -7.951804963447007,
                                  -7.946949170263277, -7.939707384646695,
                                  -7.930696994306516, -7.920391751706345,
                                  -7.909159074306997, -7.897287302426051,
                                  -7.885005868398116, -7.87250024359475,
                                  -7.8599229028612685, -7.847401190339061,
                                  -7.835042767891952, -7.82293920754877,
                                  -7.811168212439553, -7.799794892637229,
                                  -7.788872467273269, -7.778442702008336,
                                  -7.768536317478178, -7.759173523064854])
    elif mol_type == 'H2O':
        values = classical_calcs([-71.60104569676616, -73.7539836029613,
                                  -74.7791146842303, -75.28750687358158,
                                  -75.54135743898377, -75.66396026613415,
                                  -75.71689664238885, -75.73222927190515,
                                  -75.72731015342738, -75.71195060328186,
                                  -75.69193108711775, -75.67075279958972,
                                  -75.65054204054096, -75.63252697639415,
                                  -75.61730032454582, -75.60499168302927,
                                  -75.59541304676448, -75.58819350221611,
                                  -75.58289292600809, -75.57908217640258,
                                  -75.57638754694894, -75.57450684146608,
                                  -75.57320780689791, -75.5723181706986,
                                  -75.57171330962431, -75.5713046752696,
                                  -75.57103018480773, -75.57084676210968,
                                  -75.57072477617947, -75.57064399854178,
                                  -75.57059071452504, -75.57055568536883],
                                 [-71.57783755483396, -73.7270054272365,
                                  -74.74880032019752, -75.2538925966075,
                                  -75.50410669492717, -75.62244292960645,
                                  -75.6702236616171, -75.6792640248499,
                                  -75.66667487034792, -75.64204112575229,
                                  -75.61095246094719, -75.57678821273724,
                                  -75.54166500564614, -75.50695559779757,
                                  -75.47357232878475, -75.44211993201797,
                                  -75.41297888806297, -75.38635512821654,
                                  -75.36231598568193, -75.34082168979688,
                                  -75.32175490396874, -75.3049474391129,
                                  -75.29020259275536, -75.27731230111539,
                                  -75.26606929172235, -75.25627506203153,
                                  -75.24774470227712, -74.88034210266622,
                                  -74.8776547296442, -74.84169656475353,
                                  -74.72185183054235, -74.87451879261279])
    elif mol_type == 'H3+':
        values = classical_calcs([0.7930249944681114, -0.23748138680009934,
                                 -0.7527805858030647, -1.0251057217763129,
                                 -1.1699429398436902, -1.2433092266100079,
                                 -1.2748268385778991, -1.2811879994251272,
                                 -1.2722647705355452, -1.2541321018359217,
                                 -1.2306719129030717, -1.2044585772543408,
                                 -1.1772556560041043, -1.1502958922569917,
                                 -1.1244398972305532, -1.1002689580616158,
                                 -1.078144480023318, -1.0582520399914663,
                                 -1.0406387409179958, -1.0252471289480645,
                                 -1.0119461452363505, -1.000558408005646,
                                 -0.9908829093203826, -0.9827125641869094,
                                 -0.9758466366305582, -0.9700986094113239,
                                 -0.965300395780803, -0.9613038824951537,
                                 -0.9579807036602964, -0.9552209634214407,
                                 -0.9529314255228291, -0.9510335121611926],
                                [0.8056100703877389, -0.22321436431273334,
                                 -0.7367229629714385, -1.007104547434058,
                                 -1.149785629827218, -1.220720644951825,
                                 -1.2494674834990795, -1.2526503411788528,
                                 -1.2400693045269733, -1.2177264183217722,
                                 -1.1894353848951125, -1.157714054111959,
                                 -1.1242888776973976, -1.0903826899967242,
                                 -1.0568801388727018, -1.0244247396564659,
                                 -0.9934786770804002, -0.9643624774246218,
                                 -0.9372833074829038, -0.9123563277190744,
                                 -0.8896216436058548, -0.8690585548963077,
                                 -0.8505982043862215, -0.834135171241577,
                                 -0.8195381100874414, -0.8066592862527465,
                                 -0.7953427959887899, -0.7854313231523359,
                                 -0.7767713960194255, -0.7692172166288168,
                                 -0.7626332151392133, -0.7568955278185285])

    else:
        raise Exception("VALORI CLASSICI INCOMPLETI")

    return values

